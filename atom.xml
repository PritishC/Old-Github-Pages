<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Pritish Chakraborty]]></title>
  <link href="http://PritishC.github.io/atom.xml" rel="self"/>
  <link href="http://PritishC.github.io/"/>
  <updated>2015-01-25T11:10:26+05:30</updated>
  <id>http://PritishC.github.io/</id>
  <author>
    <name><![CDATA[Pritish Chakraborty]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Tryton Module Basics and Programming Example]]></title>
    <link href="http://PritishC.github.io/blog/2014/11/02/tryton-module-basics-and-programming-example/"/>
    <updated>2014-11-02T19:22:17+05:30</updated>
    <id>http://PritishC.github.io/blog/2014/11/02/tryton-module-basics-and-programming-example</id>
    <content type="html"><![CDATA[<p>This article will cover the basics of developing a module for Tryton. After having
gone through the setup, it is finally time to make your own module. This might
turn out to be a longer post than all my previous ones, so hang in there.</p>

<!--more-->


<h2>Introduction</h2>

<p>I will use the <a href="https://github.com/PritishC/nereid-erms/tree/develop">module</a> I developed as part of an initial assignment to explain.
The Tryton <a href="http://docs.tryton.org/">documentation</a> tells us that the basic
components of a Tryton module are its models and its views.</p>

<p>The models define the backend of the application. Much like in any other ORM, they
will map to tables in a database, which in this case is controlled by the Postgres
server. The views are written in XML and they define what the user sees in the
Tryton client. Views can even be inherited and this makes for a very clever design -
<em>it supports reusability</em>.</p>

<p>Each model can have a set of fields - similar to that of a table in a DB. The fields can have types such as Integer, Char, Text, etc. as well as special relationship
types such as Many2One and One2Many. Refer the docs for more information.</p>

<p>Each view is defined in the view directory and these views are brought together
in a ModelName.xml file which is at the project&rsquo;s root.</p>

<p>Now suppose we wish to build an Employee Record Management system in Tryton. The
first thing to do is to design the models, and then we would go about designing
the views. I designed models for an Employee, a Department and a Designation.</p>

<h2>The Models</h2>

<p>One may choose to have a model be stand-alone or be &lsquo;part&rsquo; of another model.
Tryton also has an easy mechanism for models which need to be customized in down-
stream modules, similar to inheritance. For example, I know that the Employee
model is already present in Tryton with the <code>__name__</code> set as <code>company.employee</code>.
I wish to customize this model and I have done so as follows -:</p>

<figure class='code'><figcaption><span>employee.py  (employee.py)</span> <a href='http://PritishC.github.io/downloads/code/erms/employee.py'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c"># -*- coding: utf-8 -*-</span>
</span><span class='line'><span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">    :copyright: (c) 2014 by Openlabs Technologies &amp; Consulting (P) Ltd.</span>
</span><span class='line'><span class="sd">    :license: GPLv3, see LICENSE for more details</span>
</span><span class='line'><span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">trytond.model</span> <span class="kn">import</span> <span class="n">fields</span><span class="p">,</span> <span class="n">ModelSQL</span><span class="p">,</span> <span class="n">ModelView</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">trytond.pyson</span> <span class="kn">import</span> <span class="n">Eval</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">trytond.pool</span> <span class="kn">import</span> <span class="n">PoolMeta</span>
</span><span class='line'>
</span><span class='line'><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Employee&#39;</span><span class="p">,</span> <span class="s">&#39;Designation&#39;</span><span class="p">]</span>
</span><span class='line'><span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">PoolMeta</span>
</span><span class='line'>
</span><span class='line'><span class="n">STATES</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="s">&#39;readonly&#39;</span><span class="p">:</span> <span class="o">~</span><span class="n">Eval</span><span class="p">(</span><span class="s">&#39;active&#39;</span><span class="p">),</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">DEPENDS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;active&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Employee</span><span class="p">:</span>
</span><span class='line'>    <span class="s">&quot;Employee&quot;</span>
</span><span class='line'>    <span class="n">__name__</span> <span class="o">=</span> <span class="s">&quot;company.employee&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">gender</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">([</span>
</span><span class='line'>        <span class="p">(</span><span class="s">&#39;male&#39;</span><span class="p">,</span> <span class="s">&#39;M&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="p">(</span><span class="s">&#39;female&#39;</span><span class="p">,</span> <span class="s">&#39;F&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="p">(</span><span class="s">&#39;undefined&#39;</span><span class="p">,</span> <span class="s">&#39;N/A&#39;</span><span class="p">),</span>
</span><span class='line'>    <span class="p">],</span> <span class="s">&#39;Gender&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
</span><span class='line'>        <span class="n">states</span><span class="o">=</span><span class="n">STATES</span><span class="p">,</span> <span class="n">depends</span><span class="o">=</span><span class="n">DEPENDS</span><span class="p">)</span>
</span><span class='line'>    <span class="n">department</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2One</span><span class="p">(</span>
</span><span class='line'>        <span class="s">&#39;company.department&#39;</span><span class="p">,</span> <span class="s">&#39;Department&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">states</span><span class="o">=</span><span class="n">STATES</span><span class="p">,</span>
</span><span class='line'>        <span class="n">depends</span><span class="o">=</span><span class="n">DEPENDS</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="n">designation</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2One</span><span class="p">(</span>
</span><span class='line'>        <span class="s">&quot;employee.designation&quot;</span><span class="p">,</span> <span class="s">&quot;Designation&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="p">[</span>
</span><span class='line'>            <span class="p">(</span><span class="s">&#39;department&#39;</span><span class="p">,</span> <span class="s">&#39;=&#39;</span><span class="p">,</span> <span class="n">Eval</span><span class="p">(</span><span class="s">&#39;department&#39;</span><span class="p">))</span>
</span><span class='line'>        <span class="p">],</span> <span class="n">states</span><span class="o">=</span><span class="n">STATES</span><span class="p">,</span> <span class="n">depends</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;active&#39;</span><span class="p">,</span> <span class="s">&#39;department&#39;</span><span class="p">],</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="n">dob</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span>
</span><span class='line'>        <span class="s">&quot;Date of Birth&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">states</span><span class="o">=</span><span class="n">STATES</span><span class="p">,</span> <span class="n">depends</span><span class="o">=</span><span class="n">DEPENDS</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="n">pan</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span>
</span><span class='line'>        <span class="s">&quot;PAN&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">states</span><span class="o">=</span><span class="n">STATES</span><span class="p">,</span> <span class="n">depends</span><span class="o">=</span><span class="n">DEPENDS</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="n">passport</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span>
</span><span class='line'>        <span class="s">&quot;Passport Number&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">states</span><span class="o">=</span><span class="n">STATES</span><span class="p">,</span>
</span><span class='line'>        <span class="n">depends</span><span class="o">=</span><span class="n">DEPENDS</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="n">driver_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span>
</span><span class='line'>        <span class="s">&quot;Drivers License&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">states</span><span class="o">=</span><span class="n">STATES</span><span class="p">,</span>
</span><span class='line'>        <span class="n">depends</span><span class="o">=</span><span class="n">DEPENDS</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="n">active</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="s">&#39;Active&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">_sql_error_messages</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;uniq_error&#39;</span><span class="p">:</span> <span class="s">&#39;This field must be unique.&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;null_error&#39;</span><span class="p">:</span> <span class="s">&#39;This field must be not null.&#39;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">_unique</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>        <span class="p">(</span><span class="s">&#39;pan&#39;</span><span class="p">,</span> <span class="s">&#39;UNIQUE(pan)&#39;</span><span class="p">,</span> <span class="n">_sql_error_messages</span><span class="p">[</span><span class="s">&#39;uniq_error&#39;</span><span class="p">]),</span>
</span><span class='line'>        <span class="p">(</span><span class="s">&#39;passport&#39;</span><span class="p">,</span> <span class="s">&#39;UNIQUE(passport)&#39;</span><span class="p">,</span> <span class="n">_sql_error_messages</span><span class="p">[</span><span class="s">&#39;uniq_error&#39;</span><span class="p">]),</span>
</span><span class='line'>        <span class="p">(</span><span class="s">&#39;driver&#39;</span><span class="p">,</span> <span class="s">&#39;UNIQUE(driver_id)&#39;</span><span class="p">,</span> <span class="n">_sql_error_messages</span><span class="p">[</span><span class="s">&#39;uniq_error&#39;</span><span class="p">])</span>
</span><span class='line'>    <span class="p">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@classmethod</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__setup__</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
</span><span class='line'>        <span class="nb">super</span><span class="p">(</span><span class="n">Employee</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">__setup__</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">cls</span><span class="o">.</span><span class="n">_set_states_depends</span><span class="p">([</span><span class="s">&#39;party&#39;</span><span class="p">,</span> <span class="s">&#39;company&#39;</span><span class="p">])</span>
</span><span class='line'>        <span class="n">cls</span><span class="o">.</span><span class="n">_sql_constraints</span> <span class="o">=</span> <span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">_unique</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@staticmethod</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">default_gender</span><span class="p">():</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&#39;male&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@staticmethod</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">default_active</span><span class="p">():</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">True</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@classmethod</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">_set_states_depends</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">arg_list</span><span class="p">):</span>
</span><span class='line'>        <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">        This method takes a list of model names</span>
</span><span class='line'><span class="sd">        as arguments (eg: &#39;party&#39;) and sets their</span>
</span><span class='line'><span class="sd">        attributes - &#39;states&#39; and &#39;depends&#39; - to</span>
</span><span class='line'><span class="sd">        the necessary values.</span>
</span><span class='line'><span class="sd">        &quot;&quot;&quot;</span>
</span><span class='line'>        <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">arg_list</span><span class="p">:</span>
</span><span class='line'>            <span class="n">module</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
</span><span class='line'>            <span class="n">module</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="n">STATES</span>
</span><span class='line'>            <span class="n">module</span><span class="o">.</span><span class="n">depends</span> <span class="o">=</span> <span class="n">DEPENDS</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Designation</span><span class="p">(</span><span class="n">ModelSQL</span><span class="p">,</span> <span class="n">ModelView</span><span class="p">):</span>
</span><span class='line'>    <span class="s">&#39;Designation&#39;</span>
</span><span class='line'>    <span class="n">__name__</span> <span class="o">=</span> <span class="s">&#39;employee.designation&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">department</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2One</span><span class="p">(</span>
</span><span class='line'>        <span class="s">&#39;company.department&#39;</span><span class="p">,</span> <span class="s">&#39;Department&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>There&rsquo;s a lot going on here, so let&rsquo;s take it step by step. We can see two models
that we wish to be in the Employee &lsquo;namespace&rsquo;, <code>Employee</code> and <code>Designation</code>.
If you think about it, after all, it is an employee who has a designation!</p>

<p>Our first field in <code>Employee</code> is a selection field - the user can select from the
options that we present to them. The options are written as a list of two-tuples.
Each two-tuple is of the format <code>(option_name, option_string)</code>.</p>

<p>The other options provided to the field type constructor are the name of the field
to be displayed, the option of making the field mandatory or required, the possible
states of the field and other fields that this one may depend on. We&rsquo;ll get to
<code>states</code> and <code>depends</code> in a moment.</p>

<p>The next field is an interesting one - it defines a many to one relationship to
the <code>Department</code> model. This means that multiple employees can belong to a single
department. The constructor arguments are quite simple to grasp - the <code>__name__</code>
of the model being related with, the string to be displayed, and so on.</p>

<p>The third field - <code>designation</code> - is very similar to <code>department</code>. The only difference
here is that we have also set a domain argument. Domains are lists of three-tuples
that can be used to form a particular selection over the records of a model.
In this case, we wish to comb through the records of a designation and select
those which belong to the department specified by the field <code>department</code>.<code>Eval</code>
is a PYSON statement which gives us a boolean value. Domains are used alot when
searching records, and they contain <a href="http://doc.tryton.org/3.4/trytond/doc/topics/pyson.html#topics-pyson"><code>PYSON</code></a> statements.</p>

<p>Since we have just covered PYSON, we may as well check out those global variables
now - <code>STATES</code> and <code>DEPENDS</code>. The former is a dict whose keys are state names,
and whose values are PYSON statements. In this case, the <code>readonly</code> state is
activated if we find that the <code>active</code> field of the model has been set to false.</p>

<p>The rest of the fields are simple Char fields and I shall not cover them in detail.</p>

<p>Let us come down to the remaining parts of the <code>Employee</code> class. <code>_sql_error_messages</code>
is a dict whose keys are names of error messages and whose values are the strings
to be displayed in case such an error occurs. <code>_unique</code> is a list of three-tuples
which define some uniqueness constraints on the model table.</p>

<p>The <code>__setup__</code> method is an incredibly useful classmethod. Note how I am updating
the <code>party</code> and <code>company</code> fields of our custom Employee class (these fields are
present in the parent Employee model, and thus, need to have their <code>states</code> and
<code>depends</code> set, for which I have made a method) here - these fields need not be
rewritten here. I am also setting the SQL constraints of the table here. All sorts
of field updation and customization can be done in <code>__setup__</code>.</p>

<p>The <code>default</code> methods are pretty self-explanatory - they return default values
for a field. We also have methods such as <code>on_change</code> and <code>on_change_with</code> -
they are quite interesting and one should browse the docs to see what they do.</p>

<p>Let&rsquo;s cover one more model class - <code>Department</code>. It has a Many2One field relating
it to the <code>Company</code> class. One may check that out here -:</p>

<figure class='code'><figcaption><span>company.py  (company.py)</span> <a href='http://PritishC.github.io/downloads/code/erms/company.py'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c"># -*- coding: utf-8 -*-</span>
</span><span class='line'><span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">    :copyright: (c) 2014 by Openlabs Technologies &amp; Consulting (P) Ltd.</span>
</span><span class='line'><span class="sd">    :license: GPLv3, see LICENSE for more details</span>
</span><span class='line'><span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">trytond.model</span> <span class="kn">import</span> <span class="n">fields</span><span class="p">,</span> <span class="n">ModelSQL</span><span class="p">,</span> <span class="n">ModelView</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">trytond.transaction</span> <span class="kn">import</span> <span class="n">Transaction</span>
</span><span class='line'>
</span><span class='line'><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Department&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Department</span><span class="p">(</span><span class="n">ModelSQL</span><span class="p">,</span> <span class="n">ModelView</span><span class="p">):</span>
</span><span class='line'>    <span class="s">&#39;Department&#39;</span>
</span><span class='line'>    <span class="n">__name__</span> <span class="o">=</span> <span class="s">&#39;company.department&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>    <span class="n">company</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2One</span><span class="p">(</span><span class="s">&#39;company.company&#39;</span><span class="p">,</span> <span class="s">&#39;Company&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@staticmethod</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">default_company</span><span class="p">():</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">Transaction</span><span class="p">()</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;company&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note how model classes that are new to the hierarchy have to specifically inherit
from classes such as <code>ModelSQL</code>, but classes which are already present and are
being customized - such as <code>Employee</code> - need not have this explicit inheritance.
The <code>__name__</code> field does this magic for us.</p>

<p>Now the <code>Department</code> is a part of the <code>Company</code> model. It has a Many2One field
relating it to <code>Company</code>. How must we obtain the company that this department
is associated with, or more precisely, the <em>active record</em> of the <code>Company</code> model,
for our default method?</p>

<p>We do so by looking for it in the transaction context. <code>context</code> is a dict which
has such keys.</p>

<p>And that wraps up model basics! Let us now move to views.</p>

<h2>The Views</h2>

<p>Let&rsquo;s check out the view for our <code>Employee</code> model. The root xml is as follows -:</p>

<figure class='code'><figcaption><span>employee.xml  (employee.xml)</span> <a href='http://PritishC.github.io/downloads/code/erms/employee.xml'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;tryton&gt;</span>
</span><span class='line'>    <span class="nt">&lt;data&gt;</span>
</span><span class='line'>        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span> <span class="na">id=</span><span class="s">&quot;employee_view_tree&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>company.employee<span class="nt">&lt;/field&gt;</span>
</span><span class='line'>            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inherit&quot;</span> <span class="na">ref=</span><span class="s">&quot;company.employee_view_tree&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>employee_tree<span class="nt">&lt;/field&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/record&gt;</span>
</span><span class='line'>        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span> <span class="na">id=</span><span class="s">&quot;employee_view_form&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>company.employee<span class="nt">&lt;/field&gt;</span>
</span><span class='line'>            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inherit&quot;</span> <span class="na">ref=</span><span class="s">&quot;company.employee_view_form&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>employee_form<span class="nt">&lt;/field&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/record&gt;</span>
</span><span class='line'>        <span class="nt">&lt;menuitem</span> <span class="na">parent=</span><span class="s">&quot;party.menu_party&quot;</span> <span class="na">action=</span><span class="s">&quot;company.act_employee_form&quot;</span>
</span><span class='line'>            <span class="na">id=</span><span class="s">&quot;menu_employee_form&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/data&gt;</span>
</span><span class='line'><span class="nt">&lt;/tryton&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Views can be of two main types - tree and form. Form views are used to enter
data while tree views are used to display them. The first two record tags deal
with, in a sense, instances of the model class with the <code>__name__</code> <code>ir.ui.view</code>.
The first is for a tree and the second for a form. Note how they are inheriting
from tree and form views which are already present in the parent Employee model.</p>

<p>The <code>menuitem</code> tag allows us to create a new menu item for an existing menu. In
this case, we add <code>Employees</code> to the <code>Party</code> menu. <code>company.act_employee_form</code> is
predefined in the parent model and we need not worry about defining it. act stands
for &ldquo;action&rdquo;, and the action here is to open the form view.</p>

<p>We may have to define our form and tree views separately, especially if they are
inheriting from a parent model, to add any extra details, or just to create from
scratch. For example, here are the form and tree views which were defined in the
employee xml -:</p>

<figure class='code'><figcaption><span>form view  (employee_form.xml)</span> <a href='http://PritishC.github.io/downloads/code/erms/view/employee_form.xml'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;data&gt;</span>
</span><span class='line'>    <span class="nt">&lt;xpath</span> <span class="na">expr=</span><span class="s">&quot;/form/field[@name=&#39;company&#39;]&quot;</span> <span class="na">position=</span><span class="s">&quot;after&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;group</span> <span class="na">col=</span><span class="s">&quot;20&quot;</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span> <span class="na">id=</span><span class="s">&quot;checkboxes&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;label</span> <span class="na">name=</span><span class="s">&quot;active&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;active&quot;</span> <span class="na">xexpand=</span><span class="s">&quot;0&quot;</span> <span class="na">width=</span><span class="s">&quot;25&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/group&gt;</span>
</span><span class='line'>        <span class="nt">&lt;notebook</span> <span class="na">colspan=</span><span class="s">&quot;6&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;page</span> <span class="na">string=</span><span class="s">&quot;General&quot;</span> <span class="na">id=</span><span class="s">&quot;general&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;label</span> <span class="na">name=</span><span class="s">&quot;gender&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;gender&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>                <span class="nt">&lt;label</span> <span class="na">name=</span><span class="s">&quot;designation&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;designation&quot;</span> <span class="na">widget=</span><span class="s">&quot;selection&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>                <span class="nt">&lt;label</span> <span class="na">name=</span><span class="s">&quot;department&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;department&quot;</span> <span class="na">widget=</span><span class="s">&quot;selection&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/page&gt;</span>
</span><span class='line'>            <span class="nt">&lt;page</span> <span class="na">string=</span><span class="s">&quot;Personal Details&quot;</span> <span class="na">id=</span><span class="s">&quot;personal&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                <span class="nt">&lt;label</span> <span class="na">name=</span><span class="s">&quot;dob&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;dob&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>                <span class="nt">&lt;label</span> <span class="na">name=</span><span class="s">&quot;pan&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;pan&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>                <span class="nt">&lt;label</span> <span class="na">name=</span><span class="s">&quot;passport&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;passport&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>                <span class="nt">&lt;label</span> <span class="na">name=</span><span class="s">&quot;driver_id&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;driver_id&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/page&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/notebook&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/xpath&gt;</span>
</span><span class='line'><span class="nt">&lt;/data&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>tree view  (employee_tree.xml)</span> <a href='http://PritishC.github.io/downloads/code/erms/view/employee_tree.xml'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;data&gt;</span>
</span><span class='line'>    <span class="nt">&lt;xpath</span> <span class="na">expr=</span><span class="s">&quot;/tree/field[@name=&#39;company&#39;]&quot;</span> <span class="na">position=</span><span class="s">&quot;after&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;gender&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;designation&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;department&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;dob&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;pan&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;passport&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;driver_id&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;active&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/xpath&gt;</span>
</span><span class='line'><span class="nt">&lt;/data&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>These views use the newer xpath syntax that the Tryton community has incorporated.
In effect, the xpath statement here tells Tryton to put our custom Employee fields
after the company field. The active field is designated as a checkbox by putting
it in a group for checkboxes.
The <code>notebook</code> tag allows one to create tabs in the form view which can be used
to categorize or classify details according to some criterion. Notebooks have
pages which contain fields in a particular category. For example, we have two pages -
<code>General Details</code> and <code>Personal Details</code>. The form view needs a label to show in
Tryton for each field name. The tree view needs no such thing.</p>

<p>Also, note how the <code>designation</code> and <code>department</code> fields are defined as selection
widgets. They will appear as drop-down menus in Tryton, and the values in these
menus will correspond to the list of active records for the <code>Designation</code> and
<code>Department</code> models, if the user has created any. I would recommend checking out
the other views at my project&rsquo;s github page.</p>

<p>Now we are left with module boilerplate and installation.</p>

<h2>Module Installation</h2>

<p>We have the raw materials for our Tryton module - but we still have no idea how
to set things up and finally install the module. My colleagues over at the company
have created a nifty command-line application which automates the process - it
can be found <a href="https://github.com/openlabs/trytond-cookiecutter">here</a>.</p>

<p>In your project&rsquo;s root directory, clone the cookiecutter module as is given in
the readme. We will be prompted to enter project configuration details, and these
may be changed anytime by modifying <code>cookiecutter.json</code>.</p>

<p>Once this is done, we can install our Tryton module&rsquo;s various dependencies and
write the module to the <code>trytond/modules</code> directory by running the following
command - <code>python setup.py install</code>. We have our Tryton database which we created
earlier - we shall install the module using this DB.</p>

<figure class='code'><figcaption><span>installing your module</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>trytond -c path/to/trytond.conf -i module_name -d db_name
</span></code></pre></td></tr></table></div></figure>


<p>One should replace module_name with &lsquo;all&rsquo; for first time installation. The -i
option can be replaced with -u to update a particular module. Module updation is
usually done when we change or add a model(s) in that module.</p>

<p>And now we should have a fully functional module in Tryton. Check it out by running
the Tryton client.</p>

<p>I hope everyone enjoyed reading this post as much as I did writing it. Until
next time then.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Overcoming SD Card Write Restrictions]]></title>
    <link href="http://PritishC.github.io/blog/2014/10/24/overcoming-sd-card-write-restrictions/"/>
    <updated>2014-10-24T13:19:42+05:30</updated>
    <id>http://PritishC.github.io/blog/2014/10/24/overcoming-sd-card-write-restrictions</id>
    <content type="html"><![CDATA[<p>I think all of us have encountered the SD card write restrictions on Android
KitKat devices at some time or the other. What makes it really annoying is that
it is necessary for security, and cannot be bypassed without root access.</p>

<!--more-->


<p>What I am going to propose here is a kind of long hack. One needs some knowledge
of SSH/SCP file transfers to attempt this procedure.</p>

<p>(If you have a SD card reader, you could just use that instead)</p>

<p>First of all, install the <a href="https://play.google.com/store/apps/details?id=berserker.android.apps.sshdroid&amp;hl=en">SSHDroid</a> app on your device.
This allows you to run a SSH server on your device, which can be accessed from
your computer. Once this is done, just open the app to start running the server.</p>

<p>It should look something like this -:</p>

<p><img src="http://PritishC.github.io/images/sshdroid.png"/></p>

<p>If you are on Linux, fire up your file manager (Nautilus/PCManFM/etc), and search
for the option to connect to a server. For example, PCManFM has the following -:</p>

<p><img src="http://PritishC.github.io/images/pcmanfm.png"/></p>

<p>Choose the SSH/SFTP protocol, enter the server details, and connect to the server.
The default credentials are <code>root</code> and password <code>admin</code>. Now look for the path
<code>/sdcard</code> or <code>/sdcard0</code>. This is a symlink to the internal memory of the Android
device.</p>

<p>Now the procedure is simple: copy/move all the files that you wish to move to the SD
card to your PC (which is connected to the SSH server). Once you are done, close
the connection. Now connect your device via USB to get access to the SD card.
Copy all your files to the SD card from your PC.</p>

<p>And there you have it! Admittedly this is a bit long, but for someone used to
doing it all the time, it wasn&rsquo;t much of a problem for me. If you are even more
terminal savvy, I would suggest keeping the device connected via USB the whole
time, and using the terminal (scp command) to transfer files directly to the SD
card from the internal memory (I haven&rsquo;t tested this as of yet).</p>

<p>Or you could just root. That too.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[An Ode to Nokia]]></title>
    <link href="http://PritishC.github.io/blog/2014/10/22/an-ode-to-nokia/"/>
    <updated>2014-10-22T10:11:23+05:30</updated>
    <id>http://PritishC.github.io/blog/2014/10/22/an-ode-to-nokia</id>
    <content type="html"><![CDATA[<p>So the time has finally come, ladies and gentlemen. Microsoft has decided to
<a href="http://www.theverge.com/2014/10/21/7026427/microsoft-lumia-nokia-brand-replacement">do away with</a> the Nokia brand altogether.</p>

<!--more-->


<p>While Nokia will still operate as a separate business, it will focus on mapping
and network infrastructure.</p>

<p>I have used both a Nokia smartphone and a regular phone (dumbphone). The defining
features of Nokia&rsquo;s phones (before MS came along) had always been sturdiness and
long battery life - both of which I have experienced. I spent four and a half
years with a <a href="http://www.gsmarena.com/nokia_n900-2917.php">Nokia N900</a>, so it
has special memories for me.</p>

<p>When it was released, N900 was all the hype. Unfortunately, as bug after bug was
discovered, and many of them remained unfixed, it could not live up to the hype.
Still, it was a pretty damn good phone and I still have it - I do not intend to
sell it. Infact, I highly doubt anyone besides Linux lovers, security researchers
and the odd enthusiast would even want it.</p>

<p>Sporting 32 gigs of internal memory and a 5MP camera with Carl Zeiss lens, I can&rsquo;t
say I didn&rsquo;t have a good time with it. It wasn&rsquo;t exactly an iPhone killer, but
it is good at what it&rsquo;s supposed to do. Unfortunately, it never really kicked off
with a proper ecosystem of its own. It is also the only phone I have seen that
supports a terminal emulator out of the box - that means a lot for geeks like me.</p>

<p>The N900 is still fighting to stay relevant. The <a href="http://neo900.org/">NeoN900</a> project
is definitely one to follow - interesting things are in the pipeline. For geeks
who prefer touch-and-type like me, this could be what we&rsquo;re looking for. I currently
use a Sony Xperia ZR, which is pretty damn good in its own right, but it&rsquo;s not
a geek&rsquo;s dream smartphone. I urge you to donate to the NeoN900 project, because
it&rsquo;s out of projects like these that the next big thing comes from.</p>

<p>Another area where the N900 still shines is in information security. <a href="www.neopwn.com">NeoPwn</a>
is a suite of mobile pentetration testing tools that can be installed on the N900.
I have not tried them yet - if I do in future, I will definitely post about it!
So far, all I have done is use <a href="www.aircrack-ng.org">aircrack-ng</a> to <em>obtain</em>
(ahem) a neighbour&rsquo;s WiFi password - they were still using the WEP form of encryption -
as an experiment with Kali Linux. But that is for another day, another post.</p>

<p>Thanks for all the good (and shitty) times, Nokia.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Beginning Tryton]]></title>
    <link href="http://PritishC.github.io/blog/2014/10/21/beginning-tryton/"/>
    <updated>2014-10-21T12:05:18+05:30</updated>
    <id>http://PritishC.github.io/blog/2014/10/21/beginning-tryton</id>
    <content type="html"><![CDATA[<p>Before we go through the setup of the Tryton client and server, one should go
through setting up the <a href="http://PritishC.github.io/blog/2014/10/16/virtualenv-setup-for-tryton/">virtualenv</a>
and <a href="http://PritishC.github.io/blog/2014/10/19/postgres-setup/">postgres</a>.
Also, install <code>libxslt-dev</code> (and perhaps <code>libz-dev</code> as well) with your package
manager because the <code>lxml</code> package needs it.</p>

<!--more-->


<p>Right, now let&rsquo;s activate our virtualenv and install the requisite packages.</p>

<figure class='code'><figcaption><span>installing tryton/trytond</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>workon trytonenv
</span><span class='line'><span class="nv">$ </span>pip install trytond trytond-party trytond-company trytond-country trytond-currency
</span><span class='line'><span class="nv">$ </span>pip install tryton
</span><span class='line'><span class="nv">$ </span>pip install psycopg2 <span class="c"># Required for DB connectivity.</span>
</span></code></pre></td></tr></table></div></figure>


<p>The packages that follow <code>trytond</code> are Tryton modules. <code>trytond</code> is the server
and <code>tryton</code> is the client. Any server needs a configuration file, and we have
one for ours too. Picked up from the Gentoo wiki -:</p>

<figure class='code'><figcaption><span>sample trytond.conf  (trytond.conf)</span> <a href='http://PritishC.github.io/downloads/code/trytond.conf'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>#This file is part of Tryton.  The COPYRIGHT file at the top level of
</span><span class='line'>#this repository contains the full copyright notices and license terms.
</span><span class='line'>[options]
</span><span class='line'>
</span><span class='line'># Activate the json-rpc protocol
</span><span class='line'>jsonrpc = *:8000
</span><span class='line'>#ssl_jsonrpc = False
</span><span class='line'>
</span><span class='line'># This is the hostname used when generating tryton URI
</span><span class='line'>#hostname_jsonrpc =
</span><span class='line'>
</span><span class='line'># Configure the path of json-rpc data
</span><span class='line'>#jsondata_path = /var/www/localhost/tryton
</span><span class='line'>
</span><span class='line'># Activate the xml-rpc protocol
</span><span class='line'>#xmlrpc = *:8069
</span><span class='line'>#ssl_xmlrpc = False
</span><span class='line'>
</span><span class='line'># Activate the webdav protocol
</span><span class='line'>#webdav = *:8080
</span><span class='line'>#ssl_webdav = False
</span><span class='line'>
</span><span class='line'># This is the hostname used when generating WebDAV URI
</span><span class='line'>#hostname_webdav =
</span><span class='line'>
</span><span class='line'># Configure the database type
</span><span class='line'># allowed values are postgresql, sqlite, mysql
</span><span class='line'>db_type = postgresql
</span><span class='line'>
</span><span class='line'># Configure the database connection
</span><span class='line'>## Note: Only databases owned by db_user will be displayed in the connection dialog
</span><span class='line'>## of the Tryton client. db_user must have create permission for new databases
</span><span class='line'>## to be able to use automatic database creation with the Tryton client.
</span><span class='line'>db_host = localhost
</span><span class='line'>db_port = 5432
</span><span class='line'>db_user = postgres
</span><span class='line'>db_password = dbpassword
</span><span class='line'>db_minconn = 1
</span><span class='line'>db_maxconn = 64
</span><span class='line'>
</span><span class='line'># Configure the postgresql path for the executable
</span><span class='line'>#pg_path = None
</span><span class='line'>
</span><span class='line'># Configure the Tryton server password
</span><span class='line'>admin_passwd = admin
</span><span class='line'>
</span><span class='line'># Configure the path of the files for the pid and the logs
</span><span class='line'>#pidfile = False
</span><span class='line'>#logfile = False
</span><span class='line'>
</span><span class='line'>#privatekey = server.pem
</span><span class='line'>#certificate = server.pem
</span><span class='line'>
</span><span class='line'># Configure the SMTP connection
</span><span class='line'>#smtp_server = localhost
</span><span class='line'>#smtp_port = 25
</span><span class='line'>#smtp_ssl = False
</span><span class='line'>#smtp_tls = False
</span><span class='line'>#smtp_password = False
</span><span class='line'>#smtp_user = False
</span><span class='line'>
</span><span class='line'># Configure the path to store attachments and sqlite database
</span><span class='line'>#data_path = /var/lib/trytond
</span><span class='line'>
</span><span class='line'># Allow to run more than one instance of trytond
</span><span class='line'>#multi_server = False
</span><span class='line'>
</span><span class='line'># Configure the session timeout (inactivity of the client in sec)
</span><span class='line'>#session_timeout = 600
</span><span class='line'>
</span><span class='line'># Enable auto-reload of modules if changed
</span><span class='line'>#auto_reload = True
</span><span class='line'>
</span><span class='line'># Prevent database listing
</span><span class='line'>#prevent_dblist = False
</span><span class='line'>
</span><span class='line'># Enable cron
</span><span class='line'># cron = True
</span><span class='line'>
</span><span class='line'># unoconv connection
</span><span class='line'>#unoconv = pipe,name=trytond;urp;StarOffice.ComponentContext
</span><span class='line'>
</span><span class='line'># Number of retries on database operational error
</span><span class='line'># retry = 5
</span><span class='line'>
</span><span class='line'># Default database language code
</span><span class='line'># language = en_US
</span><span class='line'>language = es_ES
</span><span class='line'>
</span><span class='line'># Timezone of the server
</span><span class='line'># timezone = False
</span></code></pre></td></tr></table></div></figure>


<p>You might want to change the value of the <code>db_password</code> field there, to the pass
that you had set for the postgres role earlier. You will be using this pass to
login to a database in Tryton.</p>

<p>Now, fire up two terminal windows or tabs, and run the following commands separately
in each -:</p>

<figure class='code'><figcaption><span>tryton start</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>trytond -c path/to/trytond.conf
</span><span class='line'><span class="nv">$ </span>tryton -dv
</span></code></pre></td></tr></table></div></figure>


<p>The <code>-dv</code> switch will allow you to see errors and other messages on the command
line for the Tryton client in a verbose manner.</p>

<p>You will arrive at a screen to login to the demo profile. Close that, and head
to File->Database->New Database. Note that the default administrator password
for Tryton is <code>admin</code>. Here, the <code>admin_passwd</code> field has been inserted to change
the default. One could remove this field if they wished.</p>

<p><img src="http://PritishC.github.io/images/tryton-createdb.png" /></p>

<p>Congratulations, you&rsquo;ve created your very first Tryton database. Now you can login
to it and install the necessary Tryton modules.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Postgres Setup]]></title>
    <link href="http://PritishC.github.io/blog/2014/10/19/postgres-setup/"/>
    <updated>2014-10-19T20:27:55+05:30</updated>
    <id>http://PritishC.github.io/blog/2014/10/19/postgres-setup</id>
    <content type="html"><![CDATA[<p>This article offers a simple introduction to PostgreSQL and how to install it.
It is necessary for Tryton. In effect, this article is merely filler, and one can
skip it if one wishes so.</p>

<!--more-->


<p><a href="http://www.postgresql.org/">PostgreSQL</a> is an open-source ORDBMS which is a hardcore
programmer&rsquo;s paradise. Since it is community-developed, it adheres to strict standards
and supports DB best practices. For more information, Google is your friend.</p>

<p>Now the installation of Postgres on your setup depends on the operating system you
have installed. For most Linux distros, Postgres has a distro-specific bundle which
can easily be installed using the particular package manager. It is usually advised
to install this distro-specific bundle rather then going down the generic route.</p>

<p>I had faced several problems setting up Postgres on Linux Mint because I downloaded
and executed the generic bundle. You can find some mention of those problems here
at the <a href="https://github.com/PritishC/nereid-erms/wiki">wiki</a> of a project which I
wrote as part of a company induction task. I am currently on Lubuntu, and this
time, I used the package manager. Lesson learned.</p>

<p>Another thing you ideally should do is install <a href="http://www.pgadmin.org/">PGAdmin</a>.
It is a very useful tool for management and administration of your databases. You
might often have to view a specific table inside the DB that you create for Tryton.</p>

<p>For Debian derivatives such as mine,</p>

<figure class='code'><figcaption><span>bash snippet</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo apt-get install postgresql postgresql-contrib
</span><span class='line'><span class="nv">$ </span>sudo apt-get install pgadmin3
</span></code></pre></td></tr></table></div></figure>


<p>There is also the <code>postgres</code> user setup. After one is done installing the above,
one should fire up a terminal and set the <code>postgres</code> user&rsquo;s password.</p>

<figure class='code'><figcaption><span>postgres user</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo -u postgres psql postgres
</span><span class='line'><span class="nv">$ </span><span class="se">\p</span>assword postgres
</span></code></pre></td></tr></table></div></figure>


<p>Equivalently, one could do <code>sudo su - postgres</code> to get into the postgres account,
and then run <code>psql -u postgres -h localhost</code> or something similar.
The second line in the above snippet sets a password for the postgres database
role.</p>

<p>And that&rsquo;s that. Soon, we shall be on a functioning Tryton setup!</p>
]]></content>
  </entry>
  
</feed>
